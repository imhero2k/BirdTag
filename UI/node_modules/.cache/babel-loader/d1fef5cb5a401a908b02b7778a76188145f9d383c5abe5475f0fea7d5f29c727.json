{"ast":null,"code":"import _objectSpread from \"/Users/saisaran/Desktop/BirdTag/UI/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport '../../../../utils/client/s3data/base.mjs';\nimport '../../../../utils/client/s3data/getObject.mjs';\nimport '../../../../utils/client/s3data/listObjectsV2.mjs';\nimport '../../../../utils/client/s3data/putObject.mjs';\nimport { createMultipartUpload } from '../../../../utils/client/s3data/createMultipartUpload.mjs';\nimport '../../../../utils/client/s3data/uploadPart.mjs';\nimport '../../../../utils/client/s3data/completeMultipartUpload.mjs';\nimport '../../../../utils/client/s3data/listParts.mjs';\nimport '../../../../utils/client/s3data/abortMultipartUpload.mjs';\nimport '../../../../utils/client/s3data/copyObject.mjs';\nimport '../../../../utils/client/s3data/headObject.mjs';\nimport '../../../../utils/client/s3data/deleteObject.mjs';\nimport '../../../../../../errors/types/validation.mjs';\nimport '@aws-amplify/core/internals/utils';\nimport { logger } from '../../../../../../utils/logger.mjs';\nimport { constructContentDisposition } from '../../../../utils/constructContentDisposition.mjs';\nimport { CHECKSUM_ALGORITHM_CRC32 } from '../../../../utils/constants.mjs';\nimport { calculateContentCRC32 } from '../../../../utils/crc32.mjs';\nimport { getUploadsCacheKey, findCachedUploadPartsAndEvictExpired, cacheMultipartUpload } from './uploadCache.mjs';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n/**\n * Load the in-progress multipart upload from local storage or async storage(RN) if it exists, or create a new multipart\n * upload.\n *\n * @internal\n */\nconst loadOrCreateMultipartUpload = async _ref => {\n  let {\n    s3Config,\n    data,\n    size,\n    contentType,\n    bucket,\n    accessLevel,\n    keyPrefix,\n    key,\n    contentDisposition,\n    contentEncoding,\n    metadata,\n    abortSignal,\n    checksumAlgorithm,\n    optionsHash,\n    resumableUploadsCache,\n    expectedBucketOwner\n  } = _ref;\n  const finalKey = keyPrefix !== undefined ? keyPrefix + key : key;\n  let cachedUpload;\n  if (!resumableUploadsCache) {\n    logger.debug('uploaded cache instance cannot be determined, skipping cache.');\n    cachedUpload = undefined;\n  } else {\n    const uploadCacheKey = getUploadsCacheKey({\n      size,\n      contentType,\n      file: data instanceof File ? data : undefined,\n      bucket,\n      accessLevel,\n      key,\n      optionsHash\n    });\n    const cachedUploadParts = await findCachedUploadPartsAndEvictExpired({\n      s3Config,\n      cacheKey: uploadCacheKey,\n      bucket,\n      finalKey,\n      resumableUploadsCache\n    });\n    cachedUpload = cachedUploadParts ? _objectSpread(_objectSpread({}, cachedUploadParts), {}, {\n      uploadCacheKey\n    }) : undefined;\n  }\n  if (cachedUpload) {\n    return {\n      uploadId: cachedUpload.uploadId,\n      cachedParts: cachedUpload.parts,\n      finalCrc32: cachedUpload.finalCrc32\n    };\n  } else {\n    /**\n     * Note: This step reads the uploading file from beginning to end to calculate the CRC32 checksum of the entire\n     * object before sending the 1st byte over the wire. This is a performance bottleneck when uploading large files.\n     * The rationale to do this is S3 team wants to reduce the possibility of a file getting corrupted(on disk or in\n     * memory). So we calculate the full-object checksum as soon as possible in the upload flow.\n     *\n     * Going forward we should re-evaluate this decision with S3 team. The alternative is calling calculateContentCRC32()\n     * as we upload each part sequentially with seeds from already uploaded parts, ideally inside the data chunker.\n     */\n    const finalCrc32 = checksumAlgorithm === CHECKSUM_ALGORITHM_CRC32 ? await calculateContentCRC32(data) : undefined;\n    const {\n      UploadId\n    } = await createMultipartUpload(_objectSpread(_objectSpread({}, s3Config), {}, {\n      abortSignal\n    }), {\n      Bucket: bucket,\n      Key: finalKey,\n      ContentType: contentType,\n      ContentDisposition: constructContentDisposition(contentDisposition),\n      ContentEncoding: contentEncoding,\n      Metadata: metadata,\n      ChecksumAlgorithm: finalCrc32 ? 'CRC32' : undefined,\n      ChecksumType: finalCrc32 ? 'FULL_OBJECT' : undefined,\n      ExpectedBucketOwner: expectedBucketOwner\n    });\n    if (resumableUploadsCache) {\n      const uploadCacheKey = getUploadsCacheKey({\n        size,\n        contentType,\n        file: data instanceof File ? data : undefined,\n        bucket,\n        accessLevel,\n        key,\n        optionsHash\n      });\n      await cacheMultipartUpload(resumableUploadsCache, uploadCacheKey, {\n        uploadId: UploadId,\n        bucket,\n        key,\n        finalCrc32,\n        fileName: data instanceof File ? data.name : ''\n      });\n    }\n    return {\n      uploadId: UploadId,\n      cachedParts: [],\n      finalCrc32\n    };\n  }\n};\nexport { loadOrCreateMultipartUpload };","map":{"version":3,"names":["loadOrCreateMultipartUpload","_ref","s3Config","data","size","contentType","bucket","accessLevel","keyPrefix","key","contentDisposition","contentEncoding","metadata","abortSignal","checksumAlgorithm","optionsHash","resumableUploadsCache","expectedBucketOwner","finalKey","undefined","cachedUpload","logger","debug","uploadCacheKey","getUploadsCacheKey","file","File","cachedUploadParts","findCachedUploadPartsAndEvictExpired","cacheKey","_objectSpread","uploadId","cachedParts","parts","finalCrc32","CHECKSUM_ALGORITHM_CRC32","calculateContentCRC32","UploadId","createMultipartUpload","Bucket","Key","ContentType","ContentDisposition","constructContentDisposition","ContentEncoding","Metadata","ChecksumAlgorithm","ChecksumType","ExpectedBucketOwner","cacheMultipartUpload","fileName","name"],"sources":["/Users/saisaran/Desktop/BirdTag/UI/node_modules/@aws-amplify/storage/src/providers/s3/apis/internal/uploadData/multipart/initialUpload.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { createMultipartUpload } from '../../../../utils/client/s3data';\nimport { logger } from '../../../../../../utils';\nimport { constructContentDisposition } from '../../../../utils/constructContentDisposition';\nimport { CHECKSUM_ALGORITHM_CRC32 } from '../../../../utils/constants';\nimport { calculateContentCRC32 } from '../../../../utils/crc32';\nimport { cacheMultipartUpload, findCachedUploadPartsAndEvictExpired, getUploadsCacheKey, } from './uploadCache';\n/**\n * Load the in-progress multipart upload from local storage or async storage(RN) if it exists, or create a new multipart\n * upload.\n *\n * @internal\n */\nexport const loadOrCreateMultipartUpload = async ({ s3Config, data, size, contentType, bucket, accessLevel, keyPrefix, key, contentDisposition, contentEncoding, metadata, abortSignal, checksumAlgorithm, optionsHash, resumableUploadsCache, expectedBucketOwner, }) => {\n    const finalKey = keyPrefix !== undefined ? keyPrefix + key : key;\n    let cachedUpload;\n    if (!resumableUploadsCache) {\n        logger.debug('uploaded cache instance cannot be determined, skipping cache.');\n        cachedUpload = undefined;\n    }\n    else {\n        const uploadCacheKey = getUploadsCacheKey({\n            size,\n            contentType,\n            file: data instanceof File ? data : undefined,\n            bucket,\n            accessLevel,\n            key,\n            optionsHash,\n        });\n        const cachedUploadParts = await findCachedUploadPartsAndEvictExpired({\n            s3Config,\n            cacheKey: uploadCacheKey,\n            bucket,\n            finalKey,\n            resumableUploadsCache,\n        });\n        cachedUpload = cachedUploadParts\n            ? { ...cachedUploadParts, uploadCacheKey }\n            : undefined;\n    }\n    if (cachedUpload) {\n        return {\n            uploadId: cachedUpload.uploadId,\n            cachedParts: cachedUpload.parts,\n            finalCrc32: cachedUpload.finalCrc32,\n        };\n    }\n    else {\n        /**\n         * Note: This step reads the uploading file from beginning to end to calculate the CRC32 checksum of the entire\n         * object before sending the 1st byte over the wire. This is a performance bottleneck when uploading large files.\n         * The rationale to do this is S3 team wants to reduce the possibility of a file getting corrupted(on disk or in\n         * memory). So we calculate the full-object checksum as soon as possible in the upload flow.\n         *\n         * Going forward we should re-evaluate this decision with S3 team. The alternative is calling calculateContentCRC32()\n         * as we upload each part sequentially with seeds from already uploaded parts, ideally inside the data chunker.\n         */\n        const finalCrc32 = checksumAlgorithm === CHECKSUM_ALGORITHM_CRC32\n            ? await calculateContentCRC32(data)\n            : undefined;\n        const { UploadId } = await createMultipartUpload({\n            ...s3Config,\n            abortSignal,\n        }, {\n            Bucket: bucket,\n            Key: finalKey,\n            ContentType: contentType,\n            ContentDisposition: constructContentDisposition(contentDisposition),\n            ContentEncoding: contentEncoding,\n            Metadata: metadata,\n            ChecksumAlgorithm: finalCrc32 ? 'CRC32' : undefined,\n            ChecksumType: finalCrc32 ? 'FULL_OBJECT' : undefined,\n            ExpectedBucketOwner: expectedBucketOwner,\n        });\n        if (resumableUploadsCache) {\n            const uploadCacheKey = getUploadsCacheKey({\n                size,\n                contentType,\n                file: data instanceof File ? data : undefined,\n                bucket,\n                accessLevel,\n                key,\n                optionsHash,\n            });\n            await cacheMultipartUpload(resumableUploadsCache, uploadCacheKey, {\n                uploadId: UploadId,\n                bucket,\n                key,\n                finalCrc32,\n                fileName: data instanceof File ? data.name : '',\n            });\n        }\n        return {\n            uploadId: UploadId,\n            cachedParts: [],\n            finalCrc32,\n        };\n    }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}